<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE sect1 PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
    "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<?xml-stylesheet href="../web/css/docbook/dm.css" type="text/css"?>
<sect1 id="un.id.unique">

    <sect1info>
        <releaseinfo>$Id$</releaseinfo>
    </sect1info>

    <toc></toc>

    <title>Templates : compilation</title>
<programlisting role="xml"><![CDATA[1. Constitution du source xml
=============================

- suppression des commentaires de la forme /* ... */

- ajout éventuel d'une déclaration <?xml ... ?> au début du fichier 

- ajout d'une racine unique au document xml (tout le source est englobé dans
  des tags root ignore="true" ... /root)

- insertion des fichiers "auto-includes" indiqués dans la configuration à la
  fin du source xml (juste avant la balise de fin /root)


2. Chargement du source xml dans le DOM de php
==============================================

- erreurs éventuelles "fichier xml non valide"


3. Exécution des templates match
================================

- le code de chacun des templates match vient remplacer le code de chacun des
  noeuds sélectionnés par le template

- exécution des balises {select('xxx')} présentes dans les attributs

- exécution des balises {select('xxx')} présentes dans les noeuds de type texte

- normalisation du document et suppression des text nodes vides (générés par 
  l'exécution des select)

4. Génération du code de chacun des noeuds
==========================================

- Parcours descendant-gauche-droite de l'arbre xml et génération du code de
  chaque noeud
  
- Remplacement des variables $xxx par un <?php echo binding(xxx) ?>

- Remplacement des blocs de type { xxx } par un <?php echo binding(xxx) ?>

5. Finalisation du code compilé
===============================

- Insertion en début de fichier des bindings établis à l'étape 5 

- work-around pour le problème de php qui mange les \r qui suivent les balises 
  de fin de bloc php

6. Mise en cache du source compilé
==================================
]]></programlisting>    
</sect1>